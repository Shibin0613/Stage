@page "/"
@using Microsoft.AspNetCore.Components.Forms


<body>
    <h1>Upload jouw bestand hieronder</h1>
    <br />

    <div class="uploadfile">
        <label>
            <img src="images/uploadImage.png" class="img" />
            <InputFile OnChange="UploadFile" multiple /><p>(Sleep je bestanden naar knop)</p>
        </label>
    </div>    

    @if (isLoading)
    {
        <p>Uploaden...</p>
    }
</body>

@code {
    private bool isLoading;
    private int maxAllowedFiles = 5;

    private async Task UploadFile(InputFileChangeEventArgs e)
    {
        isLoading = true;

        foreach (var file in e.GetMultipleFiles(maxAllowedFiles))
        {
            string fileName = Path.GetFileName(file.Name);
            string destinationPath = Path.Combine(@"C:\\BlazorTest", fileName);

            try
            {
                await using FileStream fs = new(destinationPath, FileMode.Create);
                await file.OpenReadStream().CopyToAsync(fs);

                Console.WriteLine($"Bestand '{file.Name}' geupload");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error met het uploaden van de bestand '{file.Name}': {ex.Message}");
            }

            Console.WriteLine(file.Name);
        }

        isLoading = false;
    }
}